<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
  <meta name="GENERATOR" content="LinuxDoc-Tools 0.9.21">
  <title>Sylpheed-Claws User's Manual: Filters, actions and templates</title>
  <link href="sylpheed-14.html" rel="next">
  <link href="sylpheed-12.html" rel="previous">
  <link href="sylpheed.html#toc13" rel="contents">
</head>
<body>
<a href="sylpheed-14.html">Next</a>
<a href="sylpheed-12.html">Previous</a>
<a href="sylpheed.html#toc13">Contents</a>
<hr>
<h2><a name="s13">11.</a> <a href="sylpheed.html#toc13">Filters,
actions and templates</a></h2>
<p>Sylpheed-Claws offers three powerful tools to help you automatically
and efficiently manage your mails. These tools are:</p>
<p>
</p>
<ul>
  <li>The <i>filters</i>, that let you sort you incoming messages and
move
them into your folders based on their sender, their content,
using regular expressions.</li>
  <li>The <i>actions</i> feature is a convenient way for the user to
launch external commands to process a complete message file including
headers and body or just one of its parts.
It allows also the use of an external command to filter the whole text
or just a selected part in the message window or in the compose window.</li>
  <li>The <i>templates</i> that let you pre-define complete messages
leaving placeholders in the text to be filled at composition time.</li>
</ul>
<p></p>
<h2><a name="ss13.1">11.1</a> <a href="sylpheed.html#toc13.1">Filters</a>
</h2>
<p>Written by Nick Selby (sylpheed@nickselby.com)</p>
<p>Sylpheed-Claws provides powerful filters to allow users to
automatically pre-sort incoming mail based on a set of rules that the
user defines. As a most simple example, let's say you work at the Acme
Grommet Company, and you want all e-mail from your co-workers to be
placed in one mailbox. To accomplish this, you would set up a filter
that would place all mail whose "From" header includes the phrase
"acmegrommet.com" into a specific mailbox.</p>
<p>Sylpheed-Claws allows you much more control than just that simple setup;
you may create filters based on several variables, including an "If
this AND that" or "If the message contains this OR does NOT contain
that"
etc. <br>
</p>
<h3>Finding The Filter Setting Dialog</h3>
<p>The filter settings dialog is located in the <i>Configuration</i>
menu, under the title "Filter Setting" or from the <i>Tools</i> menu,
under in
the <i>Create filter rules</i> sub menu. You may also use establish a
keyboard shortcut (see Keyboard Shortcuts).</p>
<h3>Setting Up Filters</h3>
<p>Name, Condition(s) and Action instructions combine to create a
Filter Rule.</p>
<p>The Name is optional. It's there to help you find your rules back.</p>
<p>Condition(s):
The dialog's second setting option establishes the Conditions, the
variable that will tell the filter what specific text to look for to
trigger a filter. Each Filter Rule may have up to two conditions sets.</p>
<p>Each Condition variable contains three sections: <i>Header</i>, <i>Keyword</i>
and <i>Predicate</i>.</p>
<p>Header is a drop-down box which defines in which message header
Sylpheed's filter will search. Choices range from <i>Subject</i> to <i>X-Mailer</i>.
</p>
<p><i>Keyword</i> is a a text box in which you may enter the text for
which the filter will search. </p>
<p><span style="font-style: italic;">Predicate</span> allows you to
choose to filter based on whether the operator contains, or does not
contain, the text you enter in the Keyword field.</p>
<p>Example: Create a Condition in which the X-Mailer field of an
incoming message contains the word 'Eudora'.</p>
<p>
</p>
<ul>
  <li>Step 1. Under the <i>Header</i> drop-down box, select <i>X-Mailer</i>.</li>
  <li>Step 2. In the <i>Keyword</i> text box, type 'eudora' (case
insensitive)</li>
  <li>Step 3. Determine appropriate <span style="font-style: italic;">Predicate</span>
setting. Default is <i>Contains</i>.</li>
</ul>
<p></p>
<p>The second Condition setting, which is set identically to the first,
also allows the user to select an AND/OR setting declaring the
relationship between the two operators. </p>
<p>Example: Create a Condition set which will process mail with a <i>From</i>
header of bob@acmegrommet.com AND a subject
of "2001 Spring Grommet Collection"</p>
<p>
</p>
<ul>
  <li>Step 1. Under the first Condition set's Header drop-down box,
select <i>From</i>.</li>
  <li>Step 2. In the <i>Keyword</i> text box, type
'bob@acmegrommet.com' (case insensitive).</li>
  <li>Step 3. Leave <i>Predicate</i> setting on default, <i>Contains</i></li>
  <li>Step 4. Leave <i>AND/OR</i> box on default setting, <i>and</i>.</li>
  <li>Step 5. Under the second Condition set's <i>Header</i> drop-down
box, select <i>Subject</i>.</li>
  <li>Step 6. In the <i>Keyword</i> text box, type '2001 spring
grommet collection' (case insensitive).</li>
  <li>Step 7. Leave <i>Predicate</i> setting on default,
    <i>Contains</i>.</li>
</ul>
<p></p>
<h3>Message Processing</h3>
<p>Once you've established the Condition(s) that will define which
messages will be processed, it's time to tell Sylpheed-Claws what to do with
messages that match the condition(s). You may choose between a few
operations such as Move, Copy, Mark, ...</p>
<p>Selecting <span style="font-style: italic;">Actions </span>will
enable you to choose what kind of action you want. Then you can choose
the value for the action (Destination, Score, Recipient, depending of
the type of the action).</p>
<h3>Filter Registration</h3>
<p>Now that you have set the Name, Condition(s) and the Action, all
that's left to do is tell Sylpheed-Claws to save the entire Filter Rule. <b>If
you skip this step, the filter won't work</b>.</p>
<p>The <i>Register Rules</i> configuration has three options: <span
 style="font-style: italic;">Add, Replace</span> and <i>Delete</i>. </p>
<p>
</p>
<ul>
  <li><i>Add </i>saves the Filter Rule.</li>
  <li><i>Replace </i>modifies an existing registered Filter Rule.</li>
  <li><i>Delete</i> will remove a previously registered Filter Rule. </li>
</ul>
<p></p>
<p>Example of adding a filter rule: Create a Filter Rule that moves all
mail with the subject of "Sylpheed-Claws Manual" into the (previously
created) mail folder "Sylpheed-Claws Manual Mail".</p>
<p>
</p>
<ul>
  <li>Step 1. Under the first Condition set <i>Header</i> drop-down
box, select <i>Subject</i>.</li>
  <li>Step 2. In the <i>Keyword</i> text box, type 'sylpheed manual'
(case insensitive).</li>
  <li>Step 3. Leave <i>Predicate</i> setting on default, <i>Contains</i>.
    <br>
  </li>
  <li>Step 4. Click Add.</li>
  <li>Step 5. Click OK.</li>
  <li>Step 6. Click the Action's Define button; select Move and
"Sylpheed-Claws Manual Mail" folder.</li>
  <li>Step 7. Click Add.</li>
  <li>Step 8. Click <i>OK</i>.</li>
  <li>Step 9. Click Add.</li>
  <li>Step 10. Click OK.</li>
</ul>
<h3>Registered Rule Order</h3>
<p>One caveat about all this: the order in which Filter Rules are
created could adversely affect your intended message sorting, and one
needs to consider this when creating or updating Filter Rules. </p>
<p>For example, a Filter Rule saying, "Move anything containing 'ABC'
to Mailbox X" listed above another Filter Rule saying "Move anything
containing 'ABCDEF' to Mailbox Y" will cause the latter of these
filters not to process. </p>
<p>Think about the way Sylpheed-Claws goes down its list: first, it would
say..
"Hmm, any messages with ABC? Ah, there's one! Move it". Then it would
think, "Okay, any messages with ABCDEF?" To which the answer would be
"no" - that ABCDEF was already filtered because it contained "ABC".</p>
<p>This isn't what we want, is it?</p>
<p>In order to avoid this, you must ensure that the more complex Filter
Rule is processed first, by placing it higher than a similar,
conflicting Filter Rule. </p>
<p>To move a Registered Rule higher or lower within the Registered Rule
box, select the rule you would like to move, and click on the <i>Up</i>
or <i>Down</i> buttons. This will "move" the rule up or down, above or
below a potentially conflicting Filter Rule. </p>
<h2><a name="ss13.2">11.2</a> <a href="sylpheed.html#toc13.2">How to
Filter Messages</a>
</h2>
<p>Filtering messages can be done in several ways:</p>
<p>
</p>
<ul>
  <li>Sylpheed-Claws automatically filters incoming mail if the checkbox <span
 style="font-style: italic;">Filter messages on receiving </span>is
checked in the account's preferences Receive tab..</li>
  <li>You can also select the option <i>Filter messages</i> from the
Summary menu.</li>
</ul>
<h2><a name="ss13.3">11.3</a> <a href="sylpheed.html#toc13.3">Filtering
mail with Procmail</a>
</h2>
<p>Another option is Procmail. Procmail is a powerful mail filtering
program that is triggered from the Mail Transport Agent (i.e. Sendmail,
Postfix, Qmail). Procmail is called by default from these programs
after receiving e-mail.</p>
<p>The trick to procmail is to tell it that mail has to be filtered
into MH mail folders. This is not difficult though.</p>
<p>Normally procmail moves mail into MBOX format, this is one large
file containing all mails in a folder. MH uses separate files for each
e-mail. All you need to do is point the destination of a procmail rule
to &lt;destination folder&gt;/. It is the "slash dot" that does the
trick.</p>
<h2><a name="ss13.4">11.4</a> <a href="sylpheed.html#toc13.4">Actions</a>
</h2>
<p>The following section is a copy of <a
 href="http://melvin.hadasht.free.fr/home/sylpheed/actions/index.html">Melvin's
page</a>.</p>
<p>The "actions" feature is a convenient way for the user to launch
external commands to process a complete message file including headers
and body or just one of its parts. It allows also the use of an
external command to filter the whole text or just a selected part in
the message window or in the compose window. This is a generic tool
that allows to do any uncommon actions on the messages, and thus
extends the possibilities of Sylpheed. For example, Sylpheed-Claws does not
include the rot13 cyphering algorithm popular in some newsgroups. It
does not support natively armored encryption or clear signing. It does
not support uuencoded messages. As all these features can be handled by
external programs, the actions provide a convenient way to use them
from the menu bar.</p>
<h3>Usage</h3>
<p>To create a new action, go to the <i>Configuration</i> menu,
select the <i>Actions...</i> entry. The <i>Actions setting</i>
dialog offers to enter the Menu name that will trigger the command. The
created menu will be found in the <i>Tools -&gt; Actions</i> submenu.
By inserting a slash / in the menu name, you create a submenu.</p>
<p>The command is entered in the Command line entry. Note that Sylpheed
stores every single email in a separate file. This allows to use the
following syntax for the command:</p>
<p>
</p>
<ul>
  <li><i>%f</i> denotes the file name of the selected message. If you
selected more than one, then the command will be launched for each
message with the appropriate file name.</li>
  <li><i>%F</i> denotes the list of the file names of the selected
message. If only one message is selected, this amounts to <i>%f</i>,
but if more messages are selected, then the command will be launched
only once with the list of the file names. (You can use both <i>%f</i>
and <i>%F</i> in one command: then the command will be launched for
each selected message with the name of this message and with the list
of all selected messages. I did not find a practical example for this.).</li>
  <li><i>%p</i> denotes the current selected message part of a
multipart message. The part is decoded accordingly. If the message is
not a multipart message, it denotes the message body.</li>
  <li>Prepending <i>&gt;</i>: this will allow you to send to the
command's standard input a text that you will enter in a dialog window.</li>
  <li>Prepending <i>*</i>: this will allow you to send to the
command's standard input a text that you will enter in a dialog window.
But in contrast to prepending <i>&gt;</i>, the entered text is hidden
(useful when entering passwords).</li>
  <li>Appending an ampersand <i>&amp;</i>: this will run the command
asynchronously. That means "fire and forget". Sylpheed-Claws won't wait for
the command to finish, nor will it catch its output or its error
messages.</li>
  <li>Prepending the vertical bar <i>|</i> (pipe-in): this will send
the current displayed text or the current selected text from the
message view or the compose window to the command standard input. The
command will silently fail if more than one message is selected.</li>
  <li>Appending the vertical bar <i>|</i> (pipe-out): this will
replace the current displayed text or the current selected text from
the message window or the compose window with the command standard
output. The command will silently fail if more than one message is
selected.</li>
  <li>Appending the "greater than" sign <i>&gt;</i> will insert the
command output in the message. The difference between the trailing <i>|</i>
is that no text will be deleted or replaced. Most used when composing
mails to insert text.</li>
</ul>
<p></p>
<p><b>Note</b>: It is not possible to use actions containing <i>%f</i>,
<i>%F</i> or <i>%p</i> from the compose window.</p>
<p>When a command is run, and unless it is run asynchronously, Sylpheed
will be insensitive to any interaction and it will wait for the command
to finish. If the command takes too long (5 seconds), it will popup a
dialog window allowing to stop it. This dialog will also be displayed
as soon as the command has some output: error messages or even its
standard output when the command is not a "pipe-out" command. When
multiple commands are being run, they are run in parallel and each
command output is separated from the outputs of the others.</p>
<h3>Examples</h3>
<p>Here are some examples that are listed in the same syntax as used
for storing the actions list. You can copy and past the definition in
your <i>&nbsp;/.sylpheed/actionsrc</i> file (exit Sylpheed-Claws before).
The syntax is very simple: one line per action, each action contains
the menu name and the command line separated by a colon and a space ":
". Alternatively, you can use <i>Configuration -&gt; Actions...</i>
and for each example enter a menu name and copy&amp;paste the text
after the colon and space ": " in the command definition.</p>
<p>
<br>
</p>
<center>
<table border="1">
  <tbody>
    <tr>
      <td><b>Purpose</b></td>
      <td><b>Definition</b></td>
      <td><b>Details</b></td>
    </tr>
    <tr>
      <td>Decoding uuencoded messages</td>
      <td>UUdeview: xdeview %F&amp;</td>
      <td>xdeview comes with uudeview. If an encoded file is splitin
multiple messages, just select them all and run the command.</td>
    </tr>
    <tr>
      <td>Display uuencoded image</td>
      <td>Display uuencoded: uudec %f&amp;</td>
      <td>Displays uuencoded files. The uudec script is to be found
here.</td>
    </tr>
    <tr>
      <td>rot13 cyphering</td>
      <td>Rot13: |tr a-zA-Z n-za-mN-ZA-M|</td>
      <td>This will apply the rot13 cyphering algorithm to the
(selected)text in the message/compose view.</td>
    </tr>
    <tr>
      <td>Save MS TNEF parts</td>
      <td>Save TNEF part: xterm -e tnef-claws %p</td>
      <td>Select the TNEF message part then use this action to
extractthe attachment.</td>
    </tr>
    <tr>
      <td>Alter messages</td>
      <td>Edit message: gvim -f %F</td>
      <td>Allows to edit any received message. Can be used to
removeunneeded message parts etc.</td>
    </tr>
    <tr>
      <td>Pretty format</td>
      <td>Par: |par 72Tbgjqw74bEe B=._A_a 72bgi|</td>
      <td>par is a utility that can pretty format any text. It does
avery good job in indenting quoted messages, and justify text.Used when
composing a message</td>
    </tr>
    <tr>
      <td>Browse</td>
      <td>Part/Dillo: dillo %p&amp;</td>
      <td>Browse the selected message part in Dillo.</td>
    </tr>
    <tr>
      <td>Clear Sign</td>
      <td>GnuPG/Clear Sign: |gpg-sign-syl|</td>
      <td>Clear sign a message. The gpg-sign-syl script is
responsiblefor asking the passphrase and for running gnupg. Make
surethat you wrap your message correctly before signing, and thatthe
resultant text will not be wrapped when sent (by disabling'wrap on
send')</td>
    </tr>
    <tr>
      <td>Verify Clear Signed</td>
      <td>GnuPG/Verify: |gpg --no-tty --verify</td>
      <td>Verify clear signed messages. The result is displayed in
theactions output dialog.</td>
    </tr>
    <tr>
      <td>Encrypt ASCII Armored</td>
      <td>GnuPG/Encrypt: | gpg-enc-syl|</td>
      <td>Encrypt message to ASCII armored. The recipient will be
askedin a xterm.</td>
    </tr>
    <tr>
      <td>Decrypt ASCII Armored</td>
      <td>GnuPG/Decrypt: *gpg --no-tty --command-fd 0 --passphrase-fd 0
--decrypt %f|</td>
      <td>Decrypt ASCII armored messages. The passphrase is to be
enteredin the opened action's input dialog.</td>
    </tr>
    <tr>
      <td>Receive key from server</td>
      <td>GnuPG/Receive Selected Key: |gpg --recv-key `cat`</td>
      <td>Select a key ID in the message view then call this action
toimport it from a key server. GnuPG option file must contain
areference to a keyserver. (Suggested by Bob Forsman)</td>
    </tr>
    <tr>
      <td>Import key from mail</td>
      <td>GnuPG/Import Key From Mail: gpg --import %p</td>
      <td>Select the message part where the public key is then importit
with this action.</td>
    </tr>
    <tr>
      <td>Insert public key in message</td>
      <td>GnuPG/Insert My Public Key: gpg --export -a MYKEYID&gt;</td>
      <td>Insert your public key in the message your are
composing.Replace MYKEYID with your key id. Needs 0.8.6claws66 or newer.</td>
    </tr>
    <tr>
      <td>Reporting SPAM</td>
      <td>Report as SPAM: spamassassin -r &gt; %f</td>
      <td>Use spamassassin to report mail as spam. Redirection (&gt;)is
possible only with version 0.7.7.</td>
    </tr>
    <tr>
      <td>Check spelling</td>
      <td>Check spelling: |T=`mktemp $HOME/.sXXXXXX`; cat - &gt;
$T;xterm -e ispell $T;cat $T;rm $T|</td>
      <td>Open a terminal and check the spelling with ispell</td>
    </tr>
    <tr>
      <td>Google for message id</td>
      <td>Google Msg ID: |google&thinsp;msgid.pl</td>
      <td>Search the web for the selected message ID. Needs
thegoogle&thinsp;msgid.pl script.</td>
    </tr>
    <tr>
      <td></td>
    </tr>
  </tbody>
</table>
</center>
<br>
<p></p>
<p>The gpg-enc-syl script is to be found <a
 href="http://melvin.hadasht.free.fr/home/sylpheed/actions/gpg-enc-syl">here
(gpg-enc-syl)</a>. It calls gpg with the --yes command line option that
you may want to remove it. See gpg manual page for info.</p>
<p>The gpg-sign-syl script is to be found <a
 href="http://melvin.hadasht.free.fr/home/sylpheed/actions/gpg-sign-syl">here
(gpg-sign-syl)</a>. It needs the ssh-askpass utility found in OpenSSH.
It can be replaced by any X11 tool that asks some (hidden) text which
is then sent to standard output. Another version that uses an xterm is
to be found <a
 href="http://melvin.hadasht.free.fr/home/sylpheed/actions/gpg-sign-syl-xterm">here
(gpg-sign-syl-xterm)</a>.</p>
<p>The uudec script is to be found <a
 href="http://melvin.hadasht.free.fr/home/sylpheed/actions/uudec">here
(uudec)</a>.
It needs uudecode and ImageMagick's display. The latter can be
replaced by any image viewer that can get input from standard input.
The script could also be modified to use temporary files instead of
standard input.</p>
<p>The google_msgid.pl script is to be found <a
 href="http://melvin.hadasht.free.fr/home/sylpheed/actions/google_msgid.pl">here
(google_msgid.pl)</a>. Example and script by Thorsten Maerz. Edit the
script to change the browser (default is mozilla).</p>
<p>The tnef-claws bash script was written by Shawn Lamson and is to be
found <a
 href="http://melvin.hadasht.free.fr/home/sylpheed/actions/tnef-claws">here</a>.
The script is well commented. You need to have the tnef package already
installed.</p>
<h2><a name="ss13.5">11.5</a> <a href="sylpheed.html#toc13.5">Templates</a>
</h2>
<p>With Sylpheed-Claws you can define mail templates to use when replying
to messages. A template can contain raw text (that will be inserted
in the composed mail without any change), and placeholders that are
replaced at composition time by the actual value of the selected
fields from the original message.</p>
<p>A typical use of the template could be to define the legal notice
to be appended to your messages (the usual notice that contains a
text like: "here are my own words and not those of my company, my
boss is not liable for them, bla, bla, bla").</p>
<p>To define a new template, in the <i>Configuration</i> menu select
the <i>Templates</i> entry and fill the form:</p>
<p>The name parameter is used to identify each template, this name
will then appear in the <i>Tools/Templates</i> menu in the
composition window.
The content of the <i>To</i> field will be appended to the original
content of the corresponding field in the message you are composing.
The content of the <i>Subject</i> field will replace the orignal
subject
of the message you are composing.</p>
<p>In the upper pane, type in the text you want to put in the template,
use the <i>Symbols</i> button to open a help window that contains
the description of all the placeholders you can use in a template
(there is one for the sender, one for the date, one for the message
ID, ...), then use the <i>Register</i> button to validate the
template. If you do not register the template, when leaving the form
the template will be canceled. To modify an existing template, select
it in the lower pane, modify its text, then use the <i>Substitute</i>
button. As you may guess, the <i>Delete</i> button removes the
selected
template. Finally validate your changes with the <i>OK</i> button.
If you use the <i>Cancel</i> button, the form is closed and your
changes
are lost (deleted templates are back, added templates are lost).</p>
<p>To use a template, open the composition window and select the
template
from the <i>Tools/Templates</i> menu. You can then choose to insert
the template into your message or to completely replace the text of the
message by the template. This only affects the body of the message.
If you choose to insert the template, its text will be inserted at the
cursor location.</p>
<p>The placeholders are taken from the source message when replying, so
they have no meaning when composing a new message.</p>
<hr>
<a href="sylpheed-14.html">Next</a>
<a href="sylpheed-12.html">Previous</a>
<a href="sylpheed.html#toc13">Contents</a>
</body>
</html>
